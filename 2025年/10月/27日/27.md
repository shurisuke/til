

# rakeタスクをdocker環境のcronサービスを使ってwheneverで管理するときの方法

## 前提
- whenever を Gemfile に入れている
- rake タスクが存在している（例：rake articles:publish）
- Docker イメージに cron がインストールされている（apt-get install cron）

## 概要
- whenever gem を使って、cronジョブの定義を schedule.rb に記述
- whenever コマンドで cron 用の設定ファイル (crontab) を生成
- それを Docker コンテナの cron に登録
- rake タスクが定期実行されるようになる

① whenever を導入する
bundle install

② schedule.rb を作成
bundle exec wheneverize .

③ whenever で cronファイルを出力
$ bundle exec whenever --update-crontab

④ Dockerfileに cron と whenever 処理を追加
ronはサービスとして起動する必要があり

（⑤ cron を起動させるエントリポイントを用意）
これは今回やんなかった

⑥ docker-compose.yml の確認
バックグラウンドで cron が動いて、rakeタスクが定期実行されるようになる

# 重要
環境変数の引き継ぎ
cron は環境変数を持たないため、PATHやRAILS_ENVなど必要な変数を schedule.rb に書いておく必要がある。
